{"version":3,"file":"bundle.umd.js","sources":["src/utils.js","src/HttpLink.js","src/HttpLinkModule.js"],"sourcesContent":["export var mergeHeaders = function (source, destination) {\n    if (source && destination) {\n        var merged = destination\n            .keys()\n            .reduce(function (headers, name) { return headers.set(name, destination.getAll(name)); }, source);\n        return merged;\n    }\n    return destination || source;\n};\nexport function prioritize(first, second, init) {\n    if (typeof first !== 'undefined') {\n        init = first;\n    }\n    else if (typeof second !== 'undefined') {\n        init = second;\n    }\n    return init;\n}\n//# sourceMappingURL=utils.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nimport { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { ApolloLink, Observable as LinkObservable, } from 'apollo-link';\nimport { print } from 'graphql/language/printer';\nimport { mergeHeaders, prioritize } from './utils';\n// XXX find a better name for it\nvar HttpLinkHandler = /** @class */ (function (_super) {\n    __extends(HttpLinkHandler, _super);\n    function HttpLinkHandler(httpClient, options) {\n        var _this = _super.call(this) || this;\n        _this.httpClient = httpClient;\n        _this.options = options;\n        _this.requester = function (operation) {\n            return new LinkObservable(function (observer) {\n                var context = operation.getContext();\n                // decides which value to pick, Context, Options or to just use the default\n                var pick = function (key, init) {\n                    return prioritize(context[key], _this.options[key], init);\n                };\n                var includeQuery = pick('includeQuery', true);\n                var includeExtensions = pick('includeExtensions', false);\n                var method = pick('method', 'POST');\n                var url = pick('uri', 'graphql');\n                var withCredentials = pick('withCredentials');\n                var req = {\n                    method: method,\n                    url: url,\n                    body: {\n                        operationName: operation.operationName,\n                        variables: operation.variables,\n                    },\n                    options: {\n                        withCredentials: withCredentials,\n                        headers: _this.options.headers,\n                    },\n                };\n                if (includeExtensions) {\n                    req.body.extensions = operation.extensions;\n                }\n                if (includeQuery) {\n                    req.body.query = print(operation.query);\n                }\n                if (context.headers) {\n                    req.options.headers = mergeHeaders(req.options.headers, context.headers);\n                }\n                var sub = _this.fetch(req).subscribe({\n                    next: function (result) { return observer.next(result.body); },\n                    error: function (err) { return observer.error(err); },\n                    complete: function () { return observer.complete(); },\n                });\n                return function () {\n                    if (!sub.closed) {\n                        sub.unsubscribe();\n                    }\n                };\n            });\n        };\n        return _this;\n    }\n    HttpLinkHandler.prototype.request = function (op) {\n        return this.requester(op);\n    };\n    // XXX make it as a separate package so it can be used in BatchLink\n    HttpLinkHandler.prototype.fetch = function (req) {\n        var shouldUseBody = ['POST', 'PUT', 'PATCH'].indexOf(req.method.toUpperCase()) !== -1;\n        var shouldStringify = function (param) {\n            return ['variables', 'extensions'].indexOf(param.toLowerCase()) !== -1;\n        };\n        // `body` for some, `params` for others\n        var bodyOrParams = {};\n        if (shouldUseBody) {\n            bodyOrParams = {\n                body: req.body,\n            };\n        }\n        else {\n            var params = Object.keys(req.body).reduce(function (httpParams, param) {\n                var val = req.body[param];\n                if (shouldStringify(param.toLowerCase())) {\n                    val = JSON.stringify(val);\n                }\n                return httpParams.set(param, val);\n            }, new HttpParams());\n            bodyOrParams = { params: params };\n        }\n        // create a request\n        return this.httpClient.request(req.method, req.url, __assign({ observe: 'response', responseType: 'json', reportProgress: false }, bodyOrParams, req.options));\n    };\n    return HttpLinkHandler;\n}(ApolloLink));\nexport { HttpLinkHandler };\nvar HttpLink = /** @class */ (function () {\n    function HttpLink(httpClient) {\n        this.httpClient = httpClient;\n    }\n    HttpLink.prototype.create = function (options) {\n        return new HttpLinkHandler(this.httpClient, options);\n    };\n    HttpLink.decorators = [\n        { type: Injectable },\n    ];\n    /** @nocollapse */\n    HttpLink.ctorParameters = function () { return [\n        { type: HttpClient, },\n    ]; };\n    return HttpLink;\n}());\nexport { HttpLink };\n//# sourceMappingURL=HttpLink.js.map","import { NgModule } from '@angular/core';\nimport { HttpLink } from './HttpLink';\nexport var PROVIDERS = [HttpLink];\nvar HttpLinkModule = /** @class */ (function () {\n    function HttpLinkModule() {\n    }\n    HttpLinkModule.decorators = [\n        { type: NgModule, args: [{\n                    providers: PROVIDERS,\n                },] },\n    ];\n    /** @nocollapse */\n    HttpLinkModule.ctorParameters = function () { return []; };\n    return HttpLinkModule;\n}());\nexport { HttpLinkModule };\n//# sourceMappingURL=HttpLinkModule.js.map"],"names":["this","LinkObservable","print","HttpParams","ApolloLink","Injectable","HttpClient","NgModule"],"mappings":"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"}